---
title: "Technical Assessment"
author: "Please Insert Name"
date: "5/1/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r libraries}
##load any librarys you may need.  tidyverse has already been loaded here for you
libraries <- c("tidyverse")
for (l in libraries) {
  suppressPackageStartupMessages(library(l, character.only = TRUE))
}
```


## Instructions

This is an assessment project to be completed by prospective candidates looking to apply to the Biometrics Department at Denali Therapeutics.  The assessment is intended to take between 30-60 minutes to complete and is aimed at assessing required technical skills.  Please feel free to include more comprehensive or alternative approaches as you deem fit.  Completed report should be in html format.  Please create a **new github repository** to share your work with us. 



## Data 
Start by loading the dataset Theoph.  This is data relating to a  pharmacokinetics experiment of the anti-asthmatic drug theophylline.  


```{r DataLoad}
data(Theoph)
head(Theoph)
```

To add a bit more complexity, we will introduce a hypothetical demographics dataset characterizing the subjects.

```{r demographics}

##please add any corresponding data cleanup as needed
dm <- read.csv("dm.csv")
library('tidyverse')
##please add any corresponding data cleanup as needed
dm <- read.csv("dm.csv")
dm <- as.data.frame(dm)
dm1 <- dm %>% 
  mutate_if(is.factor, as.character) %>%  
  mutate(SEX, Sex = str_sub(SEX, start = 1, end = 1)) %>% 
  select(-SEX) %>%
  mutate(num = parse_number(Age)) %>%
  mutate(is.month = str_detect(Age, regex('month', ignore_case = T))) %>%
  mutate(is.week = str_detect(Age, regex('week', ignore_case = T))) 
dm_clean <- dm1 %>% 
  mutate(age = case_when(is.month ~ (num/12),
                      is.week ~ (num/52),
                      !is.month & !is.week ~ num)) %>%
  select(-num, -is.month, -is.week, -Age) %>%
  mutate(age = round(age, 1)) %>% 
  filter(age <= 150)

# Join the two datasets together
th_dm <- dm_clean %>% 
  inner_join(Theoph, by = c("SUBJECT" = "Subject"))
head(th_dm)
```

**Please characterize and provide a summary of the data stratefied by gender.**

*Hint:  Don't forget to also include characterization of age, weight and peak concentrations.*

```{r summary}
#input characterization and summary data code here.
th_dm %>% 
  group_by(Sex) %>%
  summarise(age_mean = mean(age), age_sd = sd(age),
            wt_mean = mean(Wt), wt_sd = sd(Wt),
            dose_mean = mean(Dose), dose_sd = sd(Dose),
            con_peak = max(conc))

```

## Visualization

You need to convey the data in a presentation.  Please generate figures to convey the data we have captured.  Pay particular attention to showing concentration change over time as this is a PK experiment.  Please take time to make the figure as informative as possible. Feel free to use more than one figure if needed but bear in mind that this is a presentation so fewer figures to convey the information is a plus.  Bonus points for interactivity!


```{r visualization}
##input visualization code here
th_dm %>% 
  ggplot(aes(Time, conc)) +
  geom_point(aes(group = SUBJECT, colour = SUBJECT)) + 
  geom_smooth(color = "orange", method = "loess") +
  labs(x = "Time since drug administration when the sample was drawn (hr)",
       y = "theophylline concentration in the sample (mg/L)")

```

## Analysis
Next, we would like to estimate the PK property, area under the curve (AUC), for the drug based on the available data.  Please provide an **estimate** along with **associated variability**.  Explain in detail any imputations or assumptions that were made.  

```{r AUC}
##input code for estimating AUC here.

```
